#include <oxstd.oxh>

main()
{
	// enter code

	
    // Arquivo de configuracao
 #include "./Config.ini"


															     // Variáveis do programa
    decl i, sVarSufix;
	
	/* ********* CARREGANDO MATRIX DE PESOS ********* */
    println("Carregando matrix de pessos W");
	decl mW;
    decl strMatrixDePesos;
    mW = loadmat(sprint(txMatPathW_Matrix, "PIB_PC_1.mat"));
	//println("Matriz de pesos utilizada: ", sprint(txMatPathW_Matrix, strMatrixDePesos));
    //mW = loadmat(sprint(txMatPathW_Matrix, strMatrixDePesos));
    //println("mW", mW);
	
	println("*** Iniciando estimacao dos modelos *** \n");
    // iCont : Contador da regiao atual
    // iCont2: Contador
    decl iCont;

	// Carrega a informação de qual o rank de cada região 
	decl mRankRegions;
	println("Lista de ranks das regioes: ", sprint("./mat_files/", "rankOfRegions.mat"));

	mRankRegions = loadmat(sprint("./mat_files/", "rankOfRegions.mat"));
    // println(mRankRegions);
		
    for (iCont = 1; iCont <= iQtdRegioes; ++iCont) {

		println("Rank: ", mRankRegions[iCont-1][0]);

	    // print Headder
        println("\n\n*****************************************");
        println("             Regiao ", iCont);
        println("*****************************************\n\n");
        // Inicio um nomo objeto do tipo PcGive
        println("Iniciando um nomo objeto do tipo PcGive referente a regiao ", iCont);
        decl model = new Database();

		println("\nCarregando base de dados para regiao ", iCont);
        model.Load(txDbase);

		println("\tPeriodo da base de dados");
        println("\tData inicial: ", model.GetYear1(), "-", model.GetPeriod1());
        println("\tData final: ", model.GetYear2(), "-", model.GetPeriod2());

		/* ********* CONTRUCAO DAS VARIAVEIS ESTRELA (EXTERNAS) ********* */
		// As Variaveis Star sao uma combinacao linear das variaveis esternas.
        println("(1) Iniciando construcao das variaveis star para a regiao ", iCont);

		decl mData, beta;
        //mData = model.GetAll();

		println("\tAdicionando variavel star da regiao ", iCont);
        // println(GetRegionNames(iQtdRegioes, "R", "_Desligados"));
        decl iContador;
        for (iContador = 0; iContador < columns(aVarDependenteNames); ++iContador) {
			println("\tAdicionando variavel star da regiao ", iCont, " (", aVarDependenteNames[iContador],")");
            mData = model.GetVar(GetRegionNames(iQtdRegioes, "R_", sprint("_", aVarDependenteNames[iContador])));
           	model.Append(mData * mW[][iCont - 1], sprint("star_", aVarDependenteNames[iContador]));

			//println("%c", GetRegionNames(iQtdRegioes, "R_", aVarDependenteNames[iContador]), mData[0:6][]);
        }
        println("\tConcluido construcao das variaveis star para a regiao ", iCont);
		
}
